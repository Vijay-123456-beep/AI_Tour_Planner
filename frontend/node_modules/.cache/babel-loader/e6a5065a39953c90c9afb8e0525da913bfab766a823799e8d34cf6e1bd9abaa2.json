{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\vijay\\\\OneDrive\\\\Desktop\\\\AI_Tour_Planner\\\\frontend\\\\src\\\\contexts\\\\ExpenseContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport { api } from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ExpenseContext = /*#__PURE__*/createContext();\nexport const ExpenseProvider = ({\n  children\n}) => {\n  _s();\n  const [expenses, setExpenses] = useState([]);\n  const [splits, setSplits] = useState([]);\n\n  // Load expenses from localStorage and MongoDB on mount\n  useEffect(() => {\n    try {\n      const savedExpenses = localStorage.getItem('expenses');\n      if (savedExpenses) {\n        setExpenses(JSON.parse(savedExpenses));\n      }\n    } catch (error) {\n      console.error('Error loading expenses from localStorage:', error);\n    }\n\n    // Try to fetch from backend\n    try {\n      api.get('/api/expenses/').then(response => {\n        if (response.data.success && response.data.data.length > 0) {\n          setExpenses(response.data.data);\n        }\n      }).catch(err => console.warn('Could not fetch expenses from backend:', err));\n    } catch (error) {\n      console.warn('Backend expenses fetch failed:', error);\n    }\n  }, []);\n\n  // Save expenses to localStorage whenever they change\n  useEffect(() => {\n    try {\n      localStorage.setItem('expenses', JSON.stringify(expenses));\n    } catch (error) {\n      console.error('Error saving expenses to localStorage:', error);\n    }\n  }, [expenses]);\n  const addExpense = expense => {\n    const newExpense = {\n      id: Date.now().toString(),\n      ...expense,\n      createdAt: new Date().toISOString(),\n      splits: expense.splitAmong || []\n    };\n    setExpenses([newExpense, ...expenses]);\n\n    // Try to save to backend\n    try {\n      api.post('/api/expenses/add', newExpense).catch(err => console.warn('Could not save expense to backend:', err));\n    } catch (error) {\n      console.warn('Backend expense save failed:', error);\n    }\n    return newExpense;\n  };\n  const deleteExpense = id => {\n    setExpenses(expenses.filter(e => e.id !== id));\n    setSplits(splits.filter(s => s.expenseId !== id));\n\n    // Try to delete from backend\n    try {\n      api.delete(`/api/expenses/${id}/delete`).catch(err => console.warn('Could not delete expense from backend:', err));\n    } catch (error) {\n      console.warn('Backend expense delete failed:', error);\n    }\n  };\n  const updateExpense = (id, updates) => {\n    setExpenses(expenses.map(e => e.id === id ? {\n      ...e,\n      ...updates\n    } : e));\n  };\n  const getExpense = id => {\n    return expenses.find(e => e.id === id);\n  };\n  const getExpensesByItinerary = itineraryId => {\n    return expenses.filter(e => String(e.itineraryId) === String(itineraryId));\n  };\n  const calculateSplits = (itineraryId, travelers) => {\n    const itineraryExpenses = getExpensesByItinerary(itineraryId);\n    const totalAmount = itineraryExpenses.reduce((sum, e) => sum + (parseFloat(e.amount) || 0), 0);\n    const splits = {};\n    travelers.forEach(traveler => {\n      splits[traveler] = 0;\n    });\n    itineraryExpenses.forEach(expense => {\n      var _expense$splitAmong;\n      const splitAmount = expense.amount / (((_expense$splitAmong = expense.splitAmong) === null || _expense$splitAmong === void 0 ? void 0 : _expense$splitAmong.length) || 1);\n      (expense.splitAmong || []).forEach(traveler => {\n        splits[traveler] = (splits[traveler] || 0) + splitAmount;\n      });\n    });\n    return {\n      totalAmount,\n      splits\n    };\n  };\n  const getSettlements = (itineraryId, travelers, paidBy) => {\n    const {\n      splits\n    } = calculateSplits(itineraryId, travelers);\n    const totalPerPerson = Object.values(splits).reduce((a, b) => a + b, 0) / travelers.length;\n    const settlements = [];\n    Object.entries(splits).forEach(([person, amount]) => {\n      const diff = amount - totalPerPerson;\n      if (diff > 0.01) {\n        settlements.push({\n          from: person,\n          amount: diff.toFixed(2)\n        });\n      } else if (diff < -0.01) {\n        settlements.push({\n          to: person,\n          amount: Math.abs(diff).toFixed(2)\n        });\n      }\n    });\n    return settlements;\n  };\n  return /*#__PURE__*/_jsxDEV(ExpenseContext.Provider, {\n    value: {\n      expenses,\n      addExpense,\n      deleteExpense,\n      updateExpense,\n      getExpense,\n      getExpensesByItinerary,\n      calculateSplits,\n      getSettlements\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 126,\n    columnNumber: 9\n  }, this);\n};\n_s(ExpenseProvider, \"H7yL1aJQOhmBdW86u9pqXiAFVgM=\");\n_c = ExpenseProvider;\nexport const useExpense = () => {\n  _s2();\n  const context = useContext(ExpenseContext);\n  if (!context) {\n    throw new Error('useExpense must be used within ExpenseProvider');\n  }\n  return context;\n};\n_s2(useExpense, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nvar _c;\n$RefreshReg$(_c, \"ExpenseProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","api","jsxDEV","_jsxDEV","ExpenseContext","ExpenseProvider","children","_s","expenses","setExpenses","splits","setSplits","savedExpenses","localStorage","getItem","JSON","parse","error","console","get","then","response","data","success","length","catch","err","warn","setItem","stringify","addExpense","expense","newExpense","id","Date","now","toString","createdAt","toISOString","splitAmong","post","deleteExpense","filter","e","s","expenseId","delete","updateExpense","updates","map","getExpense","find","getExpensesByItinerary","itineraryId","String","calculateSplits","travelers","itineraryExpenses","totalAmount","reduce","sum","parseFloat","amount","forEach","traveler","_expense$splitAmong","splitAmount","getSettlements","paidBy","totalPerPerson","Object","values","a","b","settlements","entries","person","diff","push","from","toFixed","to","Math","abs","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useExpense","_s2","context","Error","$RefreshReg$"],"sources":["C:/Users/vijay/OneDrive/Desktop/AI_Tour_Planner/frontend/src/contexts/ExpenseContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport { api } from '../services/api';\r\n\r\nconst ExpenseContext = createContext();\r\n\r\nexport const ExpenseProvider = ({ children }) => {\r\n    const [expenses, setExpenses] = useState([]);\r\n    const [splits, setSplits] = useState([]);\r\n\r\n    // Load expenses from localStorage and MongoDB on mount\r\n    useEffect(() => {\r\n        try {\r\n            const savedExpenses = localStorage.getItem('expenses');\r\n            if (savedExpenses) {\r\n                setExpenses(JSON.parse(savedExpenses));\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading expenses from localStorage:', error);\r\n        }\r\n        \r\n        // Try to fetch from backend\r\n        try {\r\n            api.get('/api/expenses/').then(response => {\r\n                if (response.data.success && response.data.data.length > 0) {\r\n                    setExpenses(response.data.data);\r\n                }\r\n            }).catch(err => console.warn('Could not fetch expenses from backend:', err));\r\n        } catch (error) {\r\n            console.warn('Backend expenses fetch failed:', error);\r\n        }\r\n    }, []);\r\n\r\n    // Save expenses to localStorage whenever they change\r\n    useEffect(() => {\r\n        try {\r\n            localStorage.setItem('expenses', JSON.stringify(expenses));\r\n        } catch (error) {\r\n            console.error('Error saving expenses to localStorage:', error);\r\n        }\r\n    }, [expenses]);\r\n\r\n    const addExpense = (expense) => {\r\n        const newExpense = {\r\n            id: Date.now().toString(),\r\n            ...expense,\r\n            createdAt: new Date().toISOString(),\r\n            splits: expense.splitAmong || []\r\n        };\r\n        setExpenses([newExpense, ...expenses]);\r\n        \r\n        // Try to save to backend\r\n        try {\r\n            api.post('/api/expenses/add', newExpense).catch(err => \r\n                console.warn('Could not save expense to backend:', err)\r\n            );\r\n        } catch (error) {\r\n            console.warn('Backend expense save failed:', error);\r\n        }\r\n        \r\n        return newExpense;\r\n    };\r\n\r\n    const deleteExpense = (id) => {\r\n        setExpenses(expenses.filter(e => e.id !== id));\r\n        setSplits(splits.filter(s => s.expenseId !== id));\r\n        \r\n        // Try to delete from backend\r\n        try {\r\n            api.delete(`/api/expenses/${id}/delete`).catch(err => \r\n                console.warn('Could not delete expense from backend:', err)\r\n            );\r\n        } catch (error) {\r\n            console.warn('Backend expense delete failed:', error);\r\n        }\r\n    };\r\n\r\n    const updateExpense = (id, updates) => {\r\n        setExpenses(expenses.map(e => e.id === id ? { ...e, ...updates } : e));\r\n    };\r\n\r\n    const getExpense = (id) => {\r\n        return expenses.find(e => e.id === id);\r\n    };\r\n\r\n    const getExpensesByItinerary = (itineraryId) => {\r\n        return expenses.filter(e => String(e.itineraryId) === String(itineraryId));\r\n    };\r\n\r\n    const calculateSplits = (itineraryId, travelers) => {\r\n        const itineraryExpenses = getExpensesByItinerary(itineraryId);\r\n        const totalAmount = itineraryExpenses.reduce((sum, e) => sum + (parseFloat(e.amount) || 0), 0);\r\n\r\n        const splits = {};\r\n        travelers.forEach(traveler => {\r\n            splits[traveler] = 0;\r\n        });\r\n\r\n        itineraryExpenses.forEach(expense => {\r\n            const splitAmount = expense.amount / (expense.splitAmong?.length || 1);\r\n            (expense.splitAmong || []).forEach(traveler => {\r\n                splits[traveler] = (splits[traveler] || 0) + splitAmount;\r\n            });\r\n        });\r\n\r\n        return { totalAmount, splits };\r\n    };\r\n\r\n    const getSettlements = (itineraryId, travelers, paidBy) => {\r\n        const { splits } = calculateSplits(itineraryId, travelers);\r\n        const totalPerPerson = Object.values(splits).reduce((a, b) => a + b, 0) / travelers.length;\r\n\r\n        const settlements = [];\r\n        Object.entries(splits).forEach(([person, amount]) => {\r\n            const diff = amount - totalPerPerson;\r\n            if (diff > 0.01) {\r\n                settlements.push({ from: person, amount: diff.toFixed(2) });\r\n            } else if (diff < -0.01) {\r\n                settlements.push({ to: person, amount: Math.abs(diff).toFixed(2) });\r\n            }\r\n        });\r\n\r\n        return settlements;\r\n    };\r\n\r\n    return (\r\n        <ExpenseContext.Provider value={{\r\n            expenses,\r\n            addExpense,\r\n            deleteExpense,\r\n            updateExpense,\r\n            getExpense,\r\n            getExpensesByItinerary,\r\n            calculateSplits,\r\n            getSettlements\r\n        }}>\r\n            {children}\r\n        </ExpenseContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useExpense = () => {\r\n    const context = useContext(ExpenseContext);\r\n    if (!context) {\r\n        throw new Error('useExpense must be used within ExpenseProvider');\r\n    }\r\n    return context;\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}