@startuml AI Tour Planner - Data Flow

!define RECTANGLE class
skinparam backgroundColor #FFFFFF
skinparam classAttributeIconSize 0
skinparam shadowing false
skinparam defaultFontName Arial
skinparam defaultFontSize 12
skinparam classFontSize 11
skinparam classFontStyle normal
skinparam classFontColor #333333
skinparam roundCorner 8

' Colors
defaultTextAlignment center
skinparam ArrowColor #666666
skinparam ArrowThickness 1.5

' Actors
actor User as user
actor "Admin" as admin

' External Systems
database "External APIs" as apis #FFE0B2

' System Components
rectangle "Client Application" as client #E1F5FE {
  [UI Components] as ui
  [State Management] as state
  [API Client] as api_client
  
  ui -[hidden]d- state
  state -[hidden]d- api_client
}

rectangle "Backend Services" as backend #E8F5E9 {
  [API Gateway] as gateway
  [Auth Service] as auth
  [Itinerary Service] as itinerary
  [AI Engine] as ai
  [Notification Service] as notify
  
  gateway -[hidden]d- auth
  auth -[hidden]d- itinerary
  itinerary -[hidden]d- ai
  ai -[hidden]d- notify
}

rectangle "Data Storage" as storage #F3E5F5 {
  [User DB] as userdb
  [Itinerary DB] as itindb
  [Cache] as cache
  
  userdb -[hidden]d- itindb
  itindb -[hidden]d- cache
}

' Data Flow
user -> ui : 1. Input Preferences
ui -> state : 2. Update State
state -> api_client : 3. Prepare Request
api_client -> gateway : 4. POST /api/itineraries/generate

gateway -> auth : 5. Validate Token
auth --> gateway : 6. User Verified

gateway -> itinerary : 7. Process Request
itinerary -> ai : 8. Generate Recommendations
ai -> apis : 9. Fetch POI Data
apis --> ai : 10. Return POIs

ai -> itinerary : 11. Optimized Itinerary
itinerary -> itindb : 12. Save Itinerary
itindb --> itinerary : 13. Confirmation

itinerary -> notify : 14. Notify User
notify -> user : 15. Itinerary Ready

' Admin Flow
admin -> gateway : A. Manage System
gateway -> auth : B. Verify Admin Role
auth --> gateway : C. Role Confirmed
gateway -> userdb : D. Access User Data

' Legend
legend right
  <b>Data Flow Diagram</b>\n\n
  <b>Sequence:</b>
  --
  1-6: User Authentication
  7-11: Itinerary Generation
  12-15: Data Persistence & Notification
  \n
  <b>Components:</b>
  --
  <color:#E1F5FE>Client</color> - User interface
  <color:#E8F5E9>Services</color> - Business logic
  <color:#F3E5F5>Storage</color> - Data persistence
  <color:#FFE0B2>External</color> - Third-party APIs
endlegend

@enduml
